<script src="../../scripts/jquery-1.11.3.min.js"></script>

<dom-module id="haushaltsbuch-create-expense">
  <style>

  #add_expense {
      position: fixed;
      bottom: 25px;
      right: 25px;
  }

  .progress_icons {
    background: grey;
  }

  #pages {

  }

  #done {
    position: fixed;
    bottom: 5%;
    right: 5%;
  }

  </style>
  <template>

    <iron-localstorage
      name="expenses"
      value="{{expenses}}"
      id="localstorage"
      on-iron-localstorage-load-empty="initializeDefaultExpenses"
    ></iron-localstorage>

    <paper-tabs selected="{{selected}}">
      <paper-tab><paper-fab mini icon="event" class="progress_icons"></paper-fab></paper-tab>
      <paper-tab><paper-fab mini icon="room" class="progress_icons"></paper-fab></paper-tab>
      <paper-tab><paper-fab mini icon="shopping-cart" class="progress_icons"></paper-fab></paper-tab>
    </paper-tabs>

    <iron-pages selected="{{selected}}" id="pages">
      <!-- Letzte Ausgaben & Datum -->
      <div>
        <haushaltsbuch-select-date expense-date="{{expenseDate}}"></haushaltsbuch-select-date>
        <!-- Next Step Component -->
        <haushaltsbuch-select-arrow-next-step selected="{{selected}}"></haushaltsbuch-select-arrow-next-step>
      </div>

      <!-- Location Auswahl -->
      <div>
        <haushaltsbuch-select-shopping-place expense-place="{{expensePlace}}"></haushaltsbuch-select-shopping-place>
        <!-- Next Step Component -->
        <haushaltsbuch-select-arrow-next-step selected="{{selected}}"></haushaltsbuch-select-arrow-next-step>
      </div>

      <!-- Produkt Eingabe -->
      <div>
        <haushaltsbuch-select-product expense-list = "{{expenseList}}" checkout = "{{checkout}}"></haushaltsbuch-select-product>
      </div>
    </iron-pages>
  </template>

<script>
(function() {
  Polymer({
    is: 'haushaltsbuch-create-expense',

    properties: {
      selected : {
        type: Number,
        value: 0
      },

      expenseDate : {
        type: Date,
        value: new Date()
      },

      expensePlace : {
        type: Object
      },

      expenseList : {
        type: Array
      },

      expenses : {
        type: Array
      },

      checkout : {
        type: Boolean,
        value: false,
        observer: "_checkoutChanged"
      }
    },

    _checkoutChanged : function() {
      if (this.checkout) {
        var total = 0;
        this.expenseList.forEach(function(e) {
          total += e.total;
        });
        this.push('expenses', {"date" : this.expenseDate, "place" : this.expensePlace, "expenses" : this.expenseList, "total" : total});
        this.$.localstorage.save();
        this.expenseDate = new Date();
        this.expensePlace = null;
        this.expenseList = [];

        page.redirect('/');
      } else {
        console.log("checkout changed to false");
      }
    },

    ready : function() {

    },

    initializeDefaultExpenses : function() {
      this.expenses = [];
    }
  });
})();
</script>

</dom-module>
